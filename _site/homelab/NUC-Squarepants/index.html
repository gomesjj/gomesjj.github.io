

<!doctype html>
<html lang="en-UK" class="no-js">
  <head>
    

<meta charset="utf-8">



<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="DEV | TTY Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">

<meta http-equiv="cleartype" content="on">
    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="http://localhost:4000/">DEV | TTY</a></li>
          
            
              
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/year-archive/">Posts</a></li>
          
            
              
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/categories/">Categories</a></li>
          
            
              
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/tags/">Tags</a></li>
          
            
              
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/about/">About</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    





<div id="main" role="main">
  


  <div class="sidebar sticky">
  




<div itemscope itemtype="http://schema.org/Person">

  <div class="author__avatar">
    
    	<img src="http://localhost:4000/images/bio-photo.png" class="author__avatar" alt="Jose Gomes">
    
  </div>

  <div class="author__content">
    <h3 class="author__name">Jose Gomes</h3>
    <p class="author__bio">... is just another techie.</p>
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li><i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> United Kingdom</li>
      
      
      
      
      
        <li><a href="http://twitter.com/devttyuk"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
      
      
      
      
        <li><a href="http://linkedin.com/in/jjgomes"><i class="fa fa-fw fa-linkedin-square" aria-hidden="true"></i> LinkedIn</a></li>
      
      
      
      
      
      
        <li><a href="http://github.com/gomesjj"><i class="fa fa-fw fa-github" aria-hidden="true"></i> Github</a></li>
      
      
      
      
      
      
      
      
      
      
      
      
      
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="NUC Squarepants">
    <meta itemprop="description" content="Adding a Mini PCIe Ethernet adapter to 3rd or 4th generation Intel NUC, housed on a 3D printed custom base.">
    <meta itemprop="datePublished" content="May 10, 2016">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">NUC Squarepants
</h1>
          
            <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 
  



  5 minutes read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        <p>My first Intel NUC was yet to be delivered, but I was already looking around for a solution for it’s greatest shortcoming: the single Ethernet adapter. So, here is how my first attempt at solving that went. </p>

<p>As I mentioned in my previous post about the evolution of my <a href="/homelab/Intel-NUC-to-the-rescue">home lab</a>, I decided to test the waters with an Intel NUC <a href="http://www.intel.co.uk/content/www/uk/en/nuc/nuc-kit-dc53427hye-board-d53427rke.html">DC53427HYEA</a>. I was as yet unsure as to whether or not the NUC would be an ESXi host, but I knew I could run Windows Server 2012 on it. If I couldn’t get a second NIC for ESXi, the NUC would still have a purpose as my new Domain Controller. </p>

<p class="notice--info">As an aside, I chose this older NUC model, and later the <a href="http://www.intel.co.uk/content/www/uk/en/nuc/nuc-kit-nuc5i5ryh.html">NUC5i5RYH</a>, because they are the only models in the line up to include Intel <abbr title="Active Management Technology">AMT</abbr>. I think running with slightly older models is a price worth paying in exchange for remote out-of-band management.</p>

<p>Well, back to our quest… I am averse to reinventing the wheel, so I started by searching for existing solutions, and found surprisingly few: this <a href="http://www.virten.net/2015/09/adding-a-second-nic-to-a-5th-gen-intel-nuc-or-other-pcie-cards/">Adding a second NIC to a 5th Gen Intel NUC</a> by Florian Grehl, and this <a href="http://blog.fosketts.net/2015/06/05/adding-a-second-ethernet-port-to-an-intel-nuc-via-mini-pcie/">Adding a Second Ethernet Port to an Intel NUC via Mini PCIe</a> by Stephen Foskett. Both solutions are very imaginative, but not quite what I had in mind.</p>

<p>I didn’t like the idea of running a full length PCIe Ethernet adapter outside the NUC enclosure like Florian did. Plus, there is a need for a second 12V power adapter to drive the NIC. Ah, and I didn’t have a 5<sup>th</sup> generation NUC as yet…</p>

<p>Stephen’s solution was closer to what I had in mind, but not quite. Using a Mini PCIe Ethernet adapter housed inside a custom base sounded just right for my NUC model, but I din’t fancy soldering the adapter directly to the board! However, I did like the idea of a custom 3D printed base for the NUC; I thought perhaps I could combine the best aspects of each approach: a Mini PCIe Ethernet adapter connected by some sort of extender, and housed in a custom base. Sounded simple enough!</p>

<p>Stephen had posted a link to his <a href="https://www.tinkercad.com/things/6cVLKjO38uJ-intel-nuc-disk-and-ethernet-base">3D model</a>, so that is what I started with. Unfortunately, the design was only available as an STL file, which I didn’t have the skills to modify the design for my own NUC model. His custom base was also meant to house a 2.5” drive, something I didn’t want or need. Luckily, a chap called David Johnston had already remixed Stephen’s design and published it in Parametric OpenSCAD format on <a href="http://www.thingiverse.com/thing:999900">Thingverse</a>, ready to be modified. The OpenSCAD format is described as code, something that felt more natural to me.</p>

<p>Without further ado, I present to you the NUC Squarepants design:</p>

<p><img src="/images/nuc/nuc_squarepants.png" alt="NUC Squarepants" class="align-center" /> </p>

<p>OK, it doesn’t look quite like that. We will see how it really looks like in a while, but first, here is the shopping list.</p>

<h3 id="components">Components</h3>

<ul>
  <li>Intel NUC 3<sup>rd</sup> or 4<sup>th</sup> generation (with mPCIe/mSATA)</li>
  <li><a href="https://www.amazon.co.uk/dp/B00B524102/ref=cm_cr_ryp_prd_ttl_sol_0">Syba Mini PCI-E Gigabit Ethernet Card</a> <strong>or</strong></li>
  <li><a href="https://www.amazon.co.uk/dp/B006VCPB2S/ref=cm_cr_ryp_prd_ttl_sol_5">Startech Mini PCI Express Gigabit Ethernet Network Adapter</a></li>
  <li><a href="https://www.amazon.co.uk/dp/B00T2FP7X4/ref=cm_cr_ryp_prd_ttl_sol_3">Mini PCI Express Extender</a></li>
  <li><a href="https://github.com/gomesjj/nuc-smartpants/blob/master/nuc_box_ver3.scad">Modified SCAD file for the 3D base</a></li>
</ul>

<p>The StarTech adapter costs twice as much as the Syba. I bought both and would say the Syba is a better bet, as the performance is identical (both are based on the Realtek R8111 chipset).</p>

<p>This is what the Syba and StarTech adapters look like:</p>

<p><img src="/images/nuc/syba.png" alt="Syba mPCIe Adapter" /> <img src="/images/nuc/startech.png" alt="Syba mPCIe Adapter" /></p>

<p>And this is the mPCIe extender:</p>

<p><img src="/images/nuc/mpcie_extender.png" alt="Syba mPCIe Adapter" class="align-center" /></p>

<p class="notice--info"><strong>Note:</strong> The small board on the left is connected to the mPCIe interface in the motherboard.</p>

<h3 id="putting-it-all-together">Putting it all together</h3>

<p>1. Remove the bracket from the Ethernet adapter, disconnect the cables and fix the RJ45 daughterboard to the custom base.</p>

<p><img src="/images/nuc/2_nuc_base_phy.png" alt="Syba mPCIe Adapter" class="align-center" /></p>

<p>2. Connect the extender to the lower slot on the motherboard (the top one is mSATA). There are perforated lines in the PCB marking where to snap it according to the required length.</p>

<p><img src="/images/nuc/1_nuc_board_adapter.png" alt="Syba mPCIe Adapter" class="align-center" /></p>

<p>3. Fix the second half of the extender (with the mPCIe connector) to the custom base.</p>

<p><img src="/images/nuc/3_nuc_base_adap.png" alt="Syba mPCIe Adapter" class="align-center" />   </p>

<p>4. Plug the main board of the Ethernet adapter to the extender in the custom base:</p>

<p><img src="/images/nuc/4_nuc_base_eth.png" alt="Syba mPCIe Adapter" class="align-center" /> </p>

<p>5. The custom base should look like this once all the cables are connected:</p>

<p><img src="/images/nuc/5_nuc_base_complete.png" alt="Syba mPCIe Adapter" class="align-center" /></p>

<p>6. Connect the flat ribbon between the base and the main board:</p>

<p><img src="/images/nuc/6_nuc_base_board.png" alt="Syba mPCIe Adapter" class="align-center" /></p>

<p><strong>Note:</strong> The flat ribbon is tucked away slightly to clear the stand-off for the mSATA adapter</p>

<p><img src="/images/nuc/6a_ribbon_detail.png" alt="Syba mPCIe Adapter" class="align-center" /></p>

<p>7. Carefully loop the flat ribbon and attach the custom base to the NUC. The base was designed with long screw posts to accommodate the original screws. Et voilà, the real NUC Squarepants:</p>

<p><img src="/images/nuc/7_nuc_complete.png" alt="Syba mPCIe Adapter" class="align-center" /></p>

<p>So we now have a NUC with a new pair of pants large enough to accommodate it’s extra  package. Oo-er missus!</p>

<p class="notice--warning"><strong>I know, I know. That is not a pair of pants, the base is not really square and there is no tie… but I like the name NUC Squarepants. I must be going senile.</strong></p>

<h3 id="making-it-all-work">Making it all work</h3>

<p>There is no out-of-the-box support for Realtek adapters on ESXi, so a driver will need to be installed. I will just point you in the direction of the excellent <a href="https://vibsdepot.v-front.de/wiki/index.php/List_of_currently_available_ESXi_packages">VIBSDepot</a> – just grab the <code>net55-r8168</code> VIB and you should be sorted.</p>

<p class="notice--info"><strong>Note:</strong> If you are not running ESXi 6.0 or 5.5 Update 3, you will also need a driver for the on-board Intel NIC. You need the <code>net-e1000e</code> VIB, so get it too whilst you are at it.</p>

<h3 id="ether-device-details">Ether device details</h3>

<p><img src="/images/nuc/mpcie_rtl_8111.png" alt="Physical adapters" /></p>

<p><img src="/images/nuc/getnics.png" alt="getnics" /></p>

<p>Interestingly, only <em>rx-checksuming</em> is enable for this driver; there is no way to set <em>tx-checksuming</em>, <em>sc</em> and <em>tso</em>, but the driver throughput is on a par with the Intel onboard NIC.</p>

<p><img src="/images/nuc/ethtool.png" alt="ethtool" /></p>

<h3 id="later-generation-nucs">Later generation NUCs</h3>

<p>This solution does not work for the 5<sup>th</sup> and later generation NUCs, as the mPCIe slot has been replaced by an M.2 slot. If you don’t mind running with a NIC outside the NUC case and a second power adapter, then Florian’s <a href="http://blog.fosketts.net/2015/06/05/adding-a-second-ethernet-port-to-an-intel-nuc-via-mini-pcie/">solution</a> is an option. Otherwise, come along this <a href="/homelab/Want-a-USB-Ethernet-driver-for-ESXi-You-can-have-two/">way</a> for a solution that will work on all generations of the NUC (or anything else with a USB port).</p>

        
      </section>

      <footer class="page__meta">
        
        


  


    
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="http://localhost:4000/tags/#homelab" class="page__taxonomy-item" rel="tag">Homelab</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/tags/#nuc" class="page__taxonomy-item" rel="tag">NUC</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/tags/#virtualisation" class="page__taxonomy-item" rel="tag">Virtualisation</a>
    
    </span>
  </p>




  




    
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="http://localhost:4000/categories/#homelab" class="page__taxonomy-item" rel="tag">homelab</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2016-05-10T00:00:00+01:00">May 10, 2016</time></p>
        
      </footer>

      

<section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/homelab/NUC-Squarepants/" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/homelab/NUC-Squarepants/" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=http://localhost:4000/homelab/NUC-Squarepants/" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/homelab/NUC-Squarepants/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>

      


  <nav class="pagination">
    
      <a href="http://localhost:4000/apple/iTunes-Library-on-NFS-share/" class="pagination--pager" title="iTunes Media Folder on NFS share
">Previous</a>
    
    
      <a href="http://localhost:4000/apple/Intel_Mesh_Commander_on_Mac_OS_X/" class="pagination--pager" title="Intel Mesh Commander on Mac OS X
">Next</a>
    
  </nav>

    </div>

    
      

<div class="page__comments">
  <h4 class="page__comments-title">Leave a Comment</h4>
  
    <section id="disqus_thread"></section>
  
</div>
    
  </article>

  
  
    <div class="page__related">
      
        <h4 class="page__related-title">You May Also Enjoy</h4>
      
      <div class="grid__wrapper">
        
          


  


<div class="grid__item">
  
    <a href="http://localhost:4000/homelab/How-I-Built-a-Lego-Rack-for-the-Intel-NUCs/">
  
    <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
      
        <div class="archive__item-teaser">
          <img src=
            
              "http://localhost:4000/images/kitchen_teaser.png"
            
            alt="">
        </div>
      
      <h2 class="archive__item-title" itemprop="headline">How I built a Lego Rack for the Intel NUCs
</h2>
      
        <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 
  



  11 minutes read
</p>
      
      <p class="archive__item-excerpt" itemprop="description">Building a Lego Rack for the Intel NUCs, including a working front door. Lots of sweat, tears and last minute purchases from eBay…
</p>
    </article>
  </a>
</div>
        
          


  


<div class="grid__item">
  
    <a href="http://localhost:4000/homelab/The-Mini-Lab/">
  
    <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
      
        <div class="archive__item-teaser">
          <img src=
            
              "http://localhost:4000/images/mini_lab_small.png"
            
            alt="">
        </div>
      
      <h2 class="archive__item-title" itemprop="headline">The Mini Lab
</h2>
      
        <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 
  



  2 minutes read
</p>
      
      <p class="archive__item-excerpt" itemprop="description">The evolution of the home lab: Intel Avoton, Intel NUC, FreeNAS, ESXi and FreeNAS
</p>
    </article>
  </a>
</div>
        
          


  


<div class="grid__item">
  
    <a href="http://localhost:4000/homelab/USB-Ethernet-driver-for-ESXi-6.5/">
  
    <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
      
        <div class="archive__item-teaser">
          <img src=
            
              "http://localhost:4000/images/usb_adapters_65.png"
            
            alt="">
        </div>
      
      <h2 class="archive__item-title" itemprop="headline">USB Ethernet driver for ESXi 6.5
</h2>
      
        <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 
  



  2 minutes read
</p>
      
      <p class="archive__item-excerpt" itemprop="description">ESXi 6.5 drivers for USB 3.0 Gigabit Ethernet adapters based on the ASIX ax88179_178a or the Realtek RLT8153/RTL8152 chipsets
</p>
    </article>
  </a>
</div>
        
          


  


<div class="grid__item">
  
    <a href="http://localhost:4000/homelab/Want-a-USB-Ethernet-driver-for-ESXi-You-can-have-two/">
  
    <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
      
        <div class="archive__item-teaser">
          <img src=
            
              "http://localhost:4000/images/usb_adapters.png"
            
            alt="">
        </div>
      
      <h2 class="archive__item-title" itemprop="headline">Want a USB Ethernet driver for ESXi? You can have two.
</h2>
      
        <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 
  



  10 minutes read
</p>
      
      <p class="archive__item-excerpt" itemprop="description">ESXi drivers for USB 3.0 Gigabit Ethernet adapters based on the ASIX ax88179_178a or the Realtek RLT8153/RTL8152 chipsets
</p>
    </article>
  </a>
</div>
        
      </div>
    </div>
  
</div>

    <div class="page__footer">
      <footer>
        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/devttyuk"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/gomesjj"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="http://localhost:4000/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2016 Jose Gomes. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>
      </footer>
    </div>

    <script src="http://localhost:4000/assets/js/main.min.js"></script>





  
  <script type="text/javascript">
  	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  	var disqus_shortname = 'devttyuk';

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function() {
  		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  	})();

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function () {
  		var s = document.createElement('script'); s.async = true;
  		s.type = 'text/javascript';
  		s.src = '//' + disqus_shortname + '.disqus.com/count.js';
  		(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  	}());
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






    <!-- start custom footer snippets -->

<!-- end custom footer snippets -->

  </body>
</html>

