

<!doctype html>
<html lang="en" class="no-js">
  <head>
    

<meta charset="utf-8">



<!-- begin SEO -->









<title>            iTunes Media Folder on NFS share - DEV      TTY      </title>







<meta property="og:locale" content="en-UK">
<meta property="og:site_name" content="DEV | TTY">
<meta property="og:title" content="iTunes Media Folder on NFS share">


  <link rel="canonical" href="http://localhost:4000/apple/iTunes-Library-on-NFS-share/">
  <meta property="og:url" content="http://localhost:4000/apple/iTunes-Library-on-NFS-share/">



  <meta property="og:description" content="Mine is a Mac household and as such, iTunes plays a part on our entertainment strategy. I generally like Apple products and software, but I must confess iTunes is not one of my preferred offerings from them.">



  <meta name="twitter:site" content="@devttyuk">
  <meta name="twitter:title" content="iTunes Media Folder on NFS share">
  <meta name="twitter:description" content="Mine is a Mac household and as such, iTunes plays a part on our entertainment strategy. I generally like Apple products and software, but I must confess iTunes is not one of my preferred offerings from them.">
  <meta name="twitter:url" content="http://localhost:4000/apple/iTunes-Library-on-NFS-share/">

  
    <meta name="twitter:card" content="summary_large_image">
    
      <meta name="twitter:image" content="http://localhost:4000/images/cat_tty.png">
    
  

  



  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2016-05-01T00:00:00+01:00">
  
    <link rel="next" href="http://localhost:4000/homelab/NUC-Squarepants/" title="NUC Squarepants">
  
  
    <link rel="prev" href="http://localhost:4000/homelab/Intel-NUC-to-the-rescue/" title="Intel NUC to the rescue">
  



  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "url": "http://localhost:4000",
      "logo": "http://localhost:4000/images/cat_tty.png"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "person",
      "name" : "Jose Gomes",
      "url" : "http://localhost:4000",
      "sameAs" : ["https://twitter.com/devttyuk","https://www.linkedin.com/in/jjgomes","https://github.com/gomesjj"]
    }
  </script>




  <meta name="msvalidate.01" content="426C494E4ED223A19760E7EA3829FC1A">



<!-- end SEO -->

<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="DEV | TTY Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">

<meta http-equiv="cleartype" content="on">
    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="http://localhost:4000/">DEV | TTY</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/year-archive/">Posts</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/categories/">Categories</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/tags/">Tags</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/about/">About</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    




  
    





<nav class="breadcrumbs">
  <ol itemscope itemtype="http://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="http://localhost:4000/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="http://localhost:4000/categories/#apple" itemprop="item"><span itemprop="name">Apple</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">iTunes Media Folder on NFS share</li>
      
    
  </ol>
</nav>
  


<div id="main" role="main">
  


  <div class="sidebar sticky">
  



<div itemscope itemtype="http://schema.org/Person">

  <div class="author__avatar">
    
    	<img src="http://localhost:4000/images/bio-photo.png" class="author__avatar" alt="Jose Gomes">
    
  </div>

  <div class="author__content">
    <h3 class="author__name">Jose Gomes</h3>
    <p class="author__bio">... is just another techie.</p>
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li><i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> United Kingdom</li>
      
      
      
      
      
        <li><a href="http://twitter.com/devttyuk"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
      
      
      
      
        <li><a href="http://linkedin.com/in/jjgomes"><i class="fa fa-fw fa-linkedin-square" aria-hidden="true"></i> LinkedIn</a></li>
      
      
      
      
      
      
        <li><a href="http://github.com/gomesjj"><i class="fa fa-fw fa-github" aria-hidden="true"></i> Github</a></li>
      
      
      
      
      
      
      
      
      
      
      
      
      
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="iTunes Media Folder on NFS share">
    <meta itemprop="description" content="Mine is a Mac household and as such, iTunes plays a part on our entertainment strategy. I generally like Apple products and software, but I must confess iTunes is not one of my preferred offerings from them.">
    <meta itemprop="datePublished" content="May 01, 2016">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">iTunes Media Folder on NFS share
</h1>
          
            <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  4 minutes read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        <p>Mine is a Mac household and as such, iTunes plays a part on our entertainment strategy. I generally like Apple products and software, but I must confess iTunes is not one of my preferred offerings from them.</p>

<p>I thought it would be a good idea to have a single repository for all the iTunes Library items residing on the NAS. By the way, the setup I have at the moment is based on two custom built FreeNAS 9.3 servers, but in the past it was based on Solaris 11 (then 11.2) running on a Sun Fire X4240. You can see what my current home lab looked like <a href="/The-Home-Lab/">here</a> – I will be documenting the new setup soon.</p>

<h3 id="all-those-funny-characters">All those funny characters</h3>

<p>The reason I chose Solaris and later FreeNAS was simply because I wanted all the ZFS goodness. With ZFS, not only did I get top availability, but both NFS and SMB sharing are baked straight into the file system. Setting up a new ZFS file system and sharing it at the same time is a doodle – except the first attempt turned into tragedy. I do have an extensive music library that includes music from all over the world. Whilst it was easy to move everything onto the NFS share, what I forgot to account for was the non-ASCII characters… As soon as I tried to access albums or songs that had, say, accented characters the whole house of cards fell apart.</p>

<p>What I needed was UTF 8 support. Not only that, but UTF 8 support that was compatible with the Unicode normalisation adopted by Apple, which is NFD. This is not something that can be changed once a ZFS file system is created, so I had to destroy the file system and recreate like so:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>zfs create -o <span class="nv">normalization</span><span class="o">=</span>formD -o <span class="nv">casesensitivity</span><span class="o">=</span>mixed -o <span class="nv">nfs</span><span class="o">=</span>on <span class="se">\</span>
-o <span class="nv">aclinherit</span><span class="o">=</span>passthrough-x -o <span class="nv">aclmode</span><span class="o">=</span>passthrough -o <span class="nv">compression</span><span class="o">=</span>on -o <span class="nv">utf8only</span><span class="o">=</span>on tank/media 
</code></pre>
</div>

<p>Now, lets forward on a few years and see if the same had to be done on FreeNAS. It turns out it didn’t. Instead, what I did was to change the “charset” and “lang” login options to support UTF 8. To do that, as root, edit <em>/etc/login.conf</em> and add the following lines to the <em>default:</em> stanza after the <em>umask</em> entry:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">:</span>charset<span class="p">=</span>UTF<span class="m">-8</span><span class="p">:</span>\
<span class="p">:</span><span class="k">lang</span><span class="p">=</span>en_GB<span class="p">.</span>UTF<span class="m">-8</span><span class="p">:</span>
</code></pre>
</div>
<p>Save the file, then run the following commands:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>cap_mkdb /etc/login.conf
cp /etc/login.conf.db /conf/base/etc
cp /etc/login.conf /conf/base/etc
</code></pre>
</div>

<p>I suppose I could have done the same with Solaris and just set the <em>charset</em> and <em>lang</em> to UTF 8, but hey.</p>

<p class="notice--warning"><strong>Note:</strong> Don’t try to add directories or files with UTF 8 characters directly from the command line – use the Finder instead and all will be peachy.</p>

<h3 id="automount-is-your-friend">Automount is your friend</h3>

<p>With my NFS share in place, I then had to look at the best way to make it available at boot time. If you look around t’interwebs, the default solution is to use the “Connect to Server” dialog in the Finder. That is not very elegant and in my experience does not survive a reboot. Well, you can add the driver to your “Login Items”, but that is even uglier. Instead, I opted for an <code class="highlighter-rouge">automount</code> map. The great thing about Mac OS X is that it is still BSD at heart, and the tools are all there.</p>

<p>So, start by creating your auto mount map, as root, using you preferred editor (I am a <code class="highlighter-rouge">vi</code> man):</p>

<div class="highlighter-rouge"><pre class="highlight"><code>
/Media -fstype=nfs,rw,bg,tcp,rsize=32768,wsize=32768,resvport,intr,nolocks,locallocks ip_address_or_hostname:/mnt/tank/media

</code></pre>
</div>

<p>I normally use the IP address so that it doesn’t depend on DNS resolution, but you can choose otherwise. In this case, my ZFS share is called <strong>media</strong> and I am mounting it under a folder called <strong>/Media</strong>.</p>

<p class="notice--warning">Do not create the mount point directory (<strong>/Media</strong> in this case). The directory will be created automatically on first mount.</p>

<p>Next, add your newly created map as the last item on <strong>/etc/auto_master</strong>, also as root:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/<span class="p">-</span>			auto_nas	<span class="p">-</span>nosuid
</code></pre>
</div>

<p>You are now ready to mount your NFS share, by executing the following command:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo automount -vc
</code></pre>
</div>
<p>That is it. If your handy work is correct the NFS share should be mounted under <strong>/Volumes/Media</strong> and ready to go.</p>

<h3 id="point-itunes-to-the-new-media-folder-location">Point iTunes to the new media folder location</h3>

<p>The last thing to do is to set the iTunes Media folder location to point at the NFS share. Click on iTunes –&gt; Preferences –&gt; Advanced –&gt; Change… and set the the media folder location:</p>

<p><img src="/images/itunes_media_folder.png" alt="iTunes Preferences" /></p>

<h3 id="thats-it">That’s it</h3>

<p>Now, this is not quite a single iTunes Library for everybody, but it is the next best thing.</p>

<p>I tried removing the “iTunes Music Library.xml” file from the local computers and having a single instance on the NAS, but that doesn’t work well long term. What it means is that if a new item is added to my library it will not be automatically added to my wife’s library – that needs to be done manually. On the other hand, I actually prefer this setup, as I don’t necessarily want some of my wife’s music on my library anyway… 😉</p>

<p class="notice--info">If you are NFS mounting your media library on a laptop and are out and about, the contents will not be accessible. If you want to have your media on the go you need to store your files locally. Or ran a VPN, as I do.</p>

        
      </section>

      <footer class="page__meta">
        
        


  




  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="http://localhost:4000/tags/#itunes" class="page__taxonomy-item" rel="tag">iTunes</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/tags/#mac" class="page__taxonomy-item" rel="tag">Mac</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/tags/#nas" class="page__taxonomy-item" rel="tag">NAS</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/tags/#nfs" class="page__taxonomy-item" rel="tag">NFS</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/tags/#os-x" class="page__taxonomy-item" rel="tag">OS X</a>
    
    </span>
  </p>




  






  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="http://localhost:4000/categories/#apple" class="page__taxonomy-item" rel="tag">Apple</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2016-05-01T00:00:00+01:00">May 01, 2016</time></p>
        
      </footer>

      

<section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/apple/iTunes-Library-on-NFS-share/" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/apple/iTunes-Library-on-NFS-share/" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=http://localhost:4000/apple/iTunes-Library-on-NFS-share/" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/apple/iTunes-Library-on-NFS-share/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>

      


  <nav class="pagination">
    
      <a href="http://localhost:4000/homelab/Intel-NUC-to-the-rescue/" class="pagination--pager" title="Intel NUC to the rescue
">Previous</a>
    
    
      <a href="http://localhost:4000/homelab/NUC-Squarepants/" class="pagination--pager" title="NUC Squarepants
">Next</a>
    
  </nav>

    </div>

    
      

<div class="page__comments">
  <h4 class="page__comments-title">Leave a Comment</h4>
  
    <section id="disqus_thread"></section>
  
</div>
    
  </article>

  
  
    <div class="page__related">
      
        <h4 class="page__related-title">You May Also Enjoy</h4>
      
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  
    <a href="http://localhost:4000/homelab/Want-a-USB-Ethernet-driver-for-ESXi-You-can-have-two/">
  
    <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
      
        <div class="archive__item-teaser">
          <img src=
            
              "http://localhost:4000/images/usb_adapters.png"
            
            alt="">
        </div>
      
      <h2 class="archive__item-title" itemprop="headline">Want a USB Ethernet driver for ESXi? You can have two.
</h2>
      
        <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  8 minutes read
</p>
      
      <p class="archive__item-excerpt" itemprop="description">Ah, that mythical home lab beast: a working USB Ethernet driver for ESXi. You wait and wait for one, and then two come along…

</p>
    </article>
  </a>
</div>
        
          



<div class="grid__item">
  
    <a href="http://localhost:4000/apple/Intel_Mesh_Commander_on_Mac_OS_X/">
  
    <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
      
        <div class="archive__item-teaser">
          <img src=
            
              "http://localhost:4000/images/commander.png"
            
            alt="">
        </div>
      
      <h2 class="archive__item-title" itemprop="headline">Intel Mesh Commander on Mac OS X
</h2>
      
        <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  5 minutes read
</p>
      
      <p class="archive__item-excerpt" itemprop="description">Intel Active Management Technology is one of the hardware technologies (perhaps the most recognised and representative) that is part of Intel’s vPro offering...</p>
    </article>
  </a>
</div>
        
          



<div class="grid__item">
  
    <a href="http://localhost:4000/homelab/NUC-Squarepants/">
  
    <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
      
        <div class="archive__item-teaser">
          <img src=
            
              "http://localhost:4000/images//nuc/nuc_squarepants.png"
            
            alt="">
        </div>
      
      <h2 class="archive__item-title" itemprop="headline">NUC Squarepants
</h2>
      
        <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  5 minutes read
</p>
      
      <p class="archive__item-excerpt" itemprop="description">My first Intel NUC was yet to be delivered, but I was already looking around for a solution for it’s greatest shortcoming: the single Ethernet adapter. So, h...</p>
    </article>
  </a>
</div>
        
          



<div class="grid__item">
  
    <a href="http://localhost:4000/homelab/Intel-NUC-to-the-rescue/">
  
    <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
      
        <div class="archive__item-teaser">
          <img src=
            
              "http://localhost:4000/images/intel-nucs.png"
            
            alt="">
        </div>
      
      <h2 class="archive__item-title" itemprop="headline">Intel NUC to the rescue
</h2>
      
        <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  1 minute read
</p>
      
      <p class="archive__item-excerpt" itemprop="description">The components of my home lab changed many times over the years, but lately I embarked on a different approach: I wanted to come up with a design that kept t...</p>
    </article>
  </a>
</div>
        
      </div>
    </div>
  
</div>

    <div class="page__footer">
      <footer>
        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/devttyuk"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/gomesjj"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="http://localhost:4000/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2016 Jose Gomes. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>
      </footer>
    </div>

    <script src="http://localhost:4000/assets/js/main.min.js"></script>





  
  <script type="text/javascript">
  	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  	var disqus_shortname = 'devttyuk';

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function() {
  		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  	})();

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function () {
  		var s = document.createElement('script'); s.async = true;
  		s.type = 'text/javascript';
  		s.src = '//' + disqus_shortname + '.disqus.com/count.js';
  		(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  	}());
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






    <!-- start custom footer snippets -->

<!-- end custom footer snippets -->

  </body>
</html>

